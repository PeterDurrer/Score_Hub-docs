import{_ as s,c as a,o as e,ag as n}from"./chunks/framework.dvv-DFtf.js";const g=JSON.parse('{"title":"Azure AD B2C","description":"","frontmatter":{},"headers":[],"relativePath":"setup/azure-b2c.md","filePath":"setup/azure-b2c.md"}'),t={name:"setup/azure-b2c.md"};function l(r,i,h,o,p,k){return e(),a("div",null,[...i[0]||(i[0]=[n(`<h1 id="azure-ad-b2c" tabindex="-1">Azure AD B2C <a class="header-anchor" href="#azure-ad-b2c" aria-label="Permalink to &quot;Azure AD B2C&quot;">​</a></h1><p>Diese Anleitung beschreibt die Konfiguration von Azure AD B2C für die Authentifizierung in ScoreHub.</p><h2 id="ubersicht" tabindex="-1">Übersicht <a class="header-anchor" href="#ubersicht" aria-label="Permalink to &quot;Übersicht&quot;">​</a></h2><p>Azure AD B2C ist der Identity Provider für ScoreHub und ermöglicht:</p><ul><li>Benutzerregistrierung und -anmeldung</li><li>Passwort-Reset</li><li>Soziale Logins (optional)</li><li>Token-basierte Authentifizierung</li><li>Multi-Faktor-Authentifizierung</li></ul><h2 id="voraussetzungen" tabindex="-1">Voraussetzungen <a class="header-anchor" href="#voraussetzungen" aria-label="Permalink to &quot;Voraussetzungen&quot;">​</a></h2><ul><li>Azure Subscription</li><li>Azure AD B2C Tenant (erstellt in Azure Portal)</li><li>Grundkenntnisse Azure AD B2C</li></ul><h2 id="b2c-tenant-erstellen" tabindex="-1">B2C Tenant erstellen <a class="header-anchor" href="#b2c-tenant-erstellen" aria-label="Permalink to &quot;B2C Tenant erstellen&quot;">​</a></h2><h3 id="_1-azure-portal" tabindex="-1">1. Azure Portal <a class="header-anchor" href="#_1-azure-portal" aria-label="Permalink to &quot;1. Azure Portal&quot;">​</a></h3><ol><li>Gehen Sie zu <strong>Azure Active Directory B2C</strong></li><li>Klicken Sie auf <strong>Neuer B2C Tenant</strong></li><li>Wählen Sie <strong>Create a new Azure AD B2C Tenant</strong></li><li>Geben Sie ein: <ul><li><strong>Organisationsname</strong>: ScoreHub</li><li><strong>Anfänglicher Domänenname</strong>: scorehub(onmicrosoft.com)</li><li><strong>Land/Region</strong>: Switzerland</li></ul></li><li>Klicken Sie auf <strong>Überprüfen + erstellen</strong></li></ol><h3 id="_2-tenant-wechseln" tabindex="-1">2. Tenant wechseln <a class="header-anchor" href="#_2-tenant-wechseln" aria-label="Permalink to &quot;2. Tenant wechseln&quot;">​</a></h3><p>Nach Erstellung des Tenants:</p><ol><li>Klicken Sie auf <strong>Verzeichnis + Abonnement</strong> in der oberen Leiste</li><li>Wählen Sie Ihren neuen B2C Tenant aus</li></ol><h2 id="user-flows-konfigurieren" tabindex="-1">User Flows konfigurieren <a class="header-anchor" href="#user-flows-konfigurieren" aria-label="Permalink to &quot;User Flows konfigurieren&quot;">​</a></h2><h3 id="_1-registrierung-und-anmeldung" tabindex="-1">1. Registrierung und Anmeldung <a class="header-anchor" href="#_1-registrierung-und-anmeldung" aria-label="Permalink to &quot;1. Registrierung und Anmeldung&quot;">​</a></h3><ol><li>Gehen Sie zu <strong>Azure AD B2C</strong> → <strong>User flows</strong></li><li>Klicken Sie auf <strong>New user flow</strong></li><li>Wählen Sie <strong>Sign up and sign in</strong></li><li>Geben Sie ein: <ul><li><strong>Name</strong>: <code>B2C_1_signup_signin</code></li><li><strong>Identity providers</strong>: Email</li></ul></li><li>Klicken Sie auf <strong>Create</strong></li></ol><h3 id="_2-user-flow-anpassen" tabindex="-1">2. User Flow anpassen <a class="header-anchor" href="#_2-user-flow-anpassen" aria-label="Permalink to &quot;2. User Flow anpassen&quot;">​</a></h3><p>Nach Erstellung des User Flows:</p><ol><li><strong>Seite Layout</strong>: Wählen Sie ein Layout (z.B. Ocean Blue)</li><li><strong>Anwendung claims</strong>: Aktivieren Sie: <ul><li><code>email</code></li><li><code>given_name</code></li><li><code>family_name</code></li><li><code>displayName</code></li></ul></li><li><strong>Token lifetime</strong>: Standard (1 Stunde)</li></ol><h3 id="_3-passwort-reset-flow" tabindex="-1">3. Passwort-Reset Flow <a class="header-anchor" href="#_3-passwort-reset-flow" aria-label="Permalink to &quot;3. Passwort-Reset Flow&quot;">​</a></h3><ol><li>Erstellen Sie einen neuen User Flow: <strong>Password reset</strong></li><li>Name: <code>B2C_1_password_reset</code></li><li>Identity providers: Email</li></ol><h2 id="anwendung-registrieren" tabindex="-1">Anwendung registrieren <a class="header-anchor" href="#anwendung-registrieren" aria-label="Permalink to &quot;Anwendung registrieren&quot;">​</a></h2><h3 id="_1-app-registration" tabindex="-1">1. App Registration <a class="header-anchor" href="#_1-app-registration" aria-label="Permalink to &quot;1. App Registration&quot;">​</a></h3><ol><li>Gehen Sie zu <strong>Azure AD B2C</strong> → <strong>App registrations</strong></li><li>Klicken Sie auf <strong>New registration</strong></li><li>Geben Sie ein: <ul><li><strong>Name</strong>: ScoreHub Web App</li><li><strong>Supported account types</strong>: Accounts in any identity provider</li><li><strong>Redirect URI</strong>: <code>http://localhost:5173</code> (für lokale Entwicklung)</li></ul></li><li>Klicken Sie auf <strong>Register</strong></li></ol><h3 id="_2-client-secret-erstellen" tabindex="-1">2. Client Secret erstellen <a class="header-anchor" href="#_2-client-secret-erstellen" aria-label="Permalink to &quot;2. Client Secret erstellen&quot;">​</a></h3><ol><li>Gehen Sie zu <strong>Certificates &amp; secrets</strong></li><li>Klicken Sie auf <strong>New client secret</strong></li><li>Geben Sie ein: <ul><li><strong>Description</strong>: ScoreHub Web App Secret</li><li><strong>Expires</strong>: Never</li></ul></li><li><strong>Speichern Sie den Secret-Wert</strong> (wird nur einmal angezeigt!)</li></ol><h3 id="_3-api-permissions" tabindex="-1">3. API Permissions <a class="header-anchor" href="#_3-api-permissions" aria-label="Permalink to &quot;3. API Permissions&quot;">​</a></h3><ol><li>Gehen Sie zu <strong>API permissions</strong></li><li>Klicken Sie auf <strong>Add a permission</strong></li><li>Wählen Sie <strong>Microsoft Graph</strong></li><li><strong>Delegated permissions</strong>: <ul><li><code>email</code></li><li><code>offline_access</code></li><li><code>openid</code></li><li><code>profile</code></li></ul></li></ol><h2 id="frontend-konfiguration" tabindex="-1">Frontend Konfiguration <a class="header-anchor" href="#frontend-konfiguration" aria-label="Permalink to &quot;Frontend Konfiguration&quot;">​</a></h2><h3 id="_1-msal-konfiguration" tabindex="-1">1. MSAL Konfiguration <a class="header-anchor" href="#_1-msal-konfiguration" aria-label="Permalink to &quot;1. MSAL Konfiguration&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// frontend/src/config/auth.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> msalConfig</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  auth: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    clientId: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITE_B2C_CLIENT_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    authority: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`https://scorehub.b2clogin.com/scorehub.onmicrosoft.com/B2C_1_signup_signin\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    knownAuthorities: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`scorehub.b2clogin.com\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    redirectUri: window.location.origin,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cache: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cacheLocation: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;localStorage&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    storeAuthStateInCookie: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> loginRequest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  scopes: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;openid&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;profile&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;email&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_2-umgebungsvariablen" tabindex="-1">2. Umgebungsvariablen <a class="header-anchor" href="#_2-umgebungsvariablen" aria-label="Permalink to &quot;2. Umgebungsvariablen&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># frontend/.env.local</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_B2C_CLIENT_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">your-client-id-here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_B2C_TENANT_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">scorehub</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">VITE_B2C_POLICY_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">B2C_1_signup_signin</span></span></code></pre></div><h2 id="backend-konfiguration" tabindex="-1">Backend Konfiguration <a class="header-anchor" href="#backend-konfiguration" aria-label="Permalink to &quot;Backend Konfiguration&quot;">​</a></h2><h3 id="_1-token-validation" tabindex="-1">1. Token Validation <a class="header-anchor" href="#_1-token-validation" aria-label="Permalink to &quot;1. Token Validation&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// api/src/utils/auth.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { jwtVerify } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;jose&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> validateToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">payload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> jwtVerify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      token,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // B2C Public Key hier laden</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getB2CPublicKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        issuer: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`https://scorehub.b2clogin.com/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">process</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">env</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">B2C_TENANT_ID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/v2.0/\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        audience: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">B2C_CLIENT_ID</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      id: payload.sub,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      email: payload.email,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      name: payload.name,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Invalid token&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_2-umgebungsvariablen-1" tabindex="-1">2. Umgebungsvariablen <a class="header-anchor" href="#_2-umgebungsvariablen-1" aria-label="Permalink to &quot;2. Umgebungsvariablen&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// api/local.settings.json</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;IsEncrypted&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;Values&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;B2C_TENANT_ID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;scorehub.onmicrosoft.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;B2C_CLIENT_ID&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;your-client-id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;B2C_POLICY_NAME&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;B2C_1_signup_signin&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="produktionsumgebung" tabindex="-1">Produktionsumgebung <a class="header-anchor" href="#produktionsumgebung" aria-label="Permalink to &quot;Produktionsumgebung&quot;">​</a></h2><h3 id="_1-redirect-uris-aktualisieren" tabindex="-1">1. Redirect URIs aktualisieren <a class="header-anchor" href="#_1-redirect-uris-aktualisieren" aria-label="Permalink to &quot;1. Redirect URIs aktualisieren&quot;">​</a></h3><p>Für Production hinzufügen:</p><ul><li><code>https://your-app.azurestaticapps.net</code></li><li><code>https://your-custom-domain.com</code></li></ul><h3 id="_2-token-lifetime-anpassen" tabindex="-1">2. Token Lifetime anpassen <a class="header-anchor" href="#_2-token-lifetime-anpassen" aria-label="Permalink to &quot;2. Token Lifetime anpassen&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// User Flow → Token lifetime</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;AccessTokenLifetime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3600&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1 Stunde</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;RefreshTokenLifetime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;604800&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 7 Tage</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;IdTokenLifetime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;3600&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         // 1 Stunde</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-security-settings" tabindex="-1">3. Security Settings <a class="header-anchor" href="#_3-security-settings" aria-label="Permalink to &quot;3. Security Settings&quot;">​</a></h3><ol><li><strong>MFA aktivieren</strong> (optional)</li><li><strong>Password complexity</strong> erhöhen</li><li><strong>Account lockout</strong> konfigurieren</li></ol><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="haufige-probleme" tabindex="-1">Häufige Probleme <a class="header-anchor" href="#haufige-probleme" aria-label="Permalink to &quot;Häufige Probleme&quot;">​</a></h3><h4 id="_1-invalid-issuer-fehler" tabindex="-1">1. &quot;Invalid issuer&quot; Fehler <a class="header-anchor" href="#_1-invalid-issuer-fehler" aria-label="Permalink to &quot;1. &quot;Invalid issuer&quot; Fehler&quot;">​</a></h4><p><strong>Problem</strong>: Token Issuer stimmt nicht überein <strong>Lösung</strong>: Überprüfen Sie den Tenant Namen in der Authority URL</p><h4 id="_2-invalid-audience-fehler" tabindex="-1">2. &quot;Invalid audience&quot; Fehler <a class="header-anchor" href="#_2-invalid-audience-fehler" aria-label="Permalink to &quot;2. &quot;Invalid audience&quot; Fehler&quot;">​</a></h4><p><strong>Problem</strong>: Client ID stimmt nicht überein <strong>Lösung</strong>: Überprüfen Sie die Client ID in der App Registration</p><h4 id="_3-cors-fehler" tabindex="-1">3. CORS Fehler <a class="header-anchor" href="#_3-cors-fehler" aria-label="Permalink to &quot;3. CORS Fehler&quot;">​</a></h4><p><strong>Problem</strong>: Frontend kann nicht mit B2C kommunizieren <strong>Lösung</strong>: Fügen Sie die Frontend Domain zu den Redirect URIs hinzu</p><h3 id="debug-tools" tabindex="-1">Debug Tools <a class="header-anchor" href="#debug-tools" aria-label="Permalink to &quot;Debug Tools&quot;">​</a></h3><h4 id="_1-jwt-io" tabindex="-1">1. JWT.io <a class="header-anchor" href="#_1-jwt-io" aria-label="Permalink to &quot;1. JWT.io&quot;">​</a></h4><p>Token decodieren und validieren:</p><ol><li>Kopieren Sie den ID Token</li><li>Fügen Sie ihn auf <a href="https://jwt.io" target="_blank" rel="noreferrer">jwt.io</a> ein</li><li>Überprüfen Sie die Claims</li></ol><h4 id="_2-b2c-user-flow-tester" tabindex="-1">2. B2C User Flow Tester <a class="header-anchor" href="#_2-b2c-user-flow-tester" aria-label="Permalink to &quot;2. B2C User Flow Tester&quot;">​</a></h4><p>Testen Sie User Flows direkt im Azure Portal:</p><ol><li>Gehen Sie zu <strong>User flows</strong></li><li>Klicken Sie auf Ihren Flow</li><li>Klicken Sie auf <strong>Run user flow</strong></li></ol><h2 id="monitoring" tabindex="-1">Monitoring <a class="header-anchor" href="#monitoring" aria-label="Permalink to &quot;Monitoring&quot;">​</a></h2><h3 id="application-insights" tabindex="-1">Application Insights <a class="header-anchor" href="#application-insights" aria-label="Permalink to &quot;Application Insights&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// B2C Custom Policy (optional)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;ClaimsProvider&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;DisplayName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Application Insights&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;TechnicalProfiles&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;Protocol&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;Name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Proprietary&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;Handler&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Web.TPEngine.Providers.AzureApplicationInsightsProvider&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="logs-analysieren" tabindex="-1">Logs analysieren <a class="header-anchor" href="#logs-analysieren" aria-label="Permalink to &quot;Logs analysieren&quot;">​</a></h3><ol><li>Gehen Sie zu <strong>Azure AD B2C</strong> → <strong>Audit logs</strong></li><li>Filtern Sie nach: <ul><li>User flows</li><li>Fehler</li><li>Anmeldungen</li></ul></li></ol><h2 id="sicherheit-best-practices" tabindex="-1">Sicherheit Best Practices <a class="header-anchor" href="#sicherheit-best-practices" aria-label="Permalink to &quot;Sicherheit Best Practices&quot;">​</a></h2><h3 id="_1-secrets-management" tabindex="-1">1. Secrets Management <a class="header-anchor" href="#_1-secrets-management" aria-label="Permalink to &quot;1. Secrets Management&quot;">​</a></h3><ul><li>Niemals Secrets im Code speichern</li><li>Azure Key Vault für Production Secrets verwenden</li><li>Client Secrets regelmäßig rotieren</li></ul><h3 id="_2-token-security" tabindex="-1">2. Token Security <a class="header-anchor" href="#_2-token-security" aria-label="Permalink to &quot;2. Token Security&quot;">​</a></h3><ul><li>Kurze Access Token Lifetimes (1 Stunde)</li><li>Lange Refresh Token Lifetimes (7 Tage)</li><li>Secure Token Storage (HttpOnly Cookies)</li></ul><h3 id="_3-user-flow-security" tabindex="-1">3. User Flow Security <a class="header-anchor" href="#_3-user-flow-security" aria-label="Permalink to &quot;3. User Flow Security&quot;">​</a></h3><ul><li>Starke Passwort Policies</li><li>MFA für sensible Operationen</li><li>Account Lockout nach fehlgeschlagenen Versuchen</li></ul><h2 id="migration-von-lokaler-auth" tabindex="-1">Migration von lokaler Auth <a class="header-anchor" href="#migration-von-lokaler-auth" aria-label="Permalink to &quot;Migration von lokaler Auth&quot;">​</a></h2><p>Wenn Sie von einem lokalen Auth-System migrieren:</p><ol><li><strong>Daten exportieren</strong>: Benutzerdaten aus alter DB exportieren</li><li><strong>B2C Bulk Import</strong>: Benutzer via Microsoft Graph API importieren</li><li><strong>Password Reset</strong>: Alle Benutzer zur Password Reset zwingen</li><li><strong>Testing</strong>: Vollständige Testdurchführung vor Go-Live</li></ol><h2 id="support" tabindex="-1">Support <a class="header-anchor" href="#support" aria-label="Permalink to &quot;Support&quot;">​</a></h2><p>Bei Problemen mit Azure AD B2C:</p><ul><li><a href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/" target="_blank" rel="noreferrer">Azure AD B2C Dokumentation</a></li><li><a href="https://stackoverflow.com/questions/tagged/azure-ad-b2c" target="_blank" rel="noreferrer">B2C Community</a></li><li><a href="https://azure.microsoft.com/en-us/support/" target="_blank" rel="noreferrer">Azure Support</a></li></ul>`,79)])])}const u=s(t,[["render",l]]);export{g as __pageData,u as default};
